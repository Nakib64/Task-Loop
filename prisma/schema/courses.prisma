// Micro-Course System

model Course {
  id          String   @id @default(cuid())
  title       String
  description String
  difficulty  String   // Beginner, Intermediate, Advanced
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  authorId    String
  author      User     @relation("CreatedCourses", fields: [authorId], references: [id])

  sections    Section[]
  enrollments Enrollment[]
  comments    Comment[]
}

model Section {
  id        String   @id @default(cuid())
  title     String
  order     Int
  courseId  String
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  
  lessons   Lesson[]
}

model Lesson {
  id        String   @id @default(cuid())
  title     String
  content   String   // Markdown or HTML
  videoUrl  String?  // Video file path/URL (uploaded via admin panel)
  order     Int
  sectionId String
  section   Section  @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  completedBy EnrollmentLesson[]
}

model Enrollment {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  courseId  String
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  enrolledAt DateTime @default(now())
  
  completedLessons EnrollmentLesson[]

  @@unique([userId, courseId])
}

model EnrollmentLesson {
  id           String     @id @default(cuid())
  enrollmentId String
  enrollment   Enrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  lessonId     String
  lesson       Lesson     @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  completedAt  DateTime   @default(now())

  @@unique([enrollmentId, lessonId])
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  courseId  String
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
}
